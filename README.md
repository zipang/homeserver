# SKYLAB - A NixOS Home Server Experience

This repository contains the NixOS configuration for my home server.

## Repository Structure

```text
.
├── flake.nix               # Entry point for Nix Flake
├── hosts/                  # Host-specific configurations
│   └── SKYLAB/
│       ├── default.nix     # Main configuration for SKYLAB
│       └── hardware-configuration.nix # Hardware-specific config (scanned from machine)
├── modules/                # Reusable NixOS modules
│   ├── services/           # Services (NFS, Docker, etc.)
│   └── system/             # System settings (SSH, Core, Nix)
└── docs/                   # Detailed documentation
```

## Manual Setup Requirements

Before deploying, ensure the following are handled manually on the SKYLAB server:

1.  **SSH Keys**: Place your authorized public keys in `/etc/nixos/ssh/authorized_keys`. These keys will be shared by all users.
2.  **Passwords**: User passwords are not stored in Git. So after the first deployment, set them manually:
    ```bash
    sudo passwd $user
    ```
3.  **Disk Labels**: Your storage drive must be labeled `MEDIAS` and your swap partition `SWAP`.
4.  **Hardware Config**: Copy the original `/etc/nixos/hardware-configuration.nix` into this repo under `hosts/SKYLAB/hardware-configuration.nix` to match your server's hardware (auto-generated by NixOS).
5.  **GitHub Access**: Generate an SSH key on the server and add it to your GitHub account to enable syncing (see `docs/install.md`).

## How to use

1. Preparation (on the Server)
  > Follow the instructions in [./docs/install.md](docs > install) to install NixOS on a new machine and sync the Flake configuration with this repo.

2. Add new feature to the server (on any machine inside a clone of the git repository)
  > Launch `opencode` and switch between PLAN and BUILD mode to update the Flake configuration
 
3. Apply Configuration (on the server)
  > A script has been added to the configuration to apply any new configuration:
  
  ```bash
  update-nix
  ```

## Advanced: Managing External Dependencies (Flake Inputs)

To avoid manual `sha256` hashing for packages or plugins not yet in `nixpkgs`, we use **Flake Inputs** in `flake.nix`. 

1.  **Add Input**: Add the source URL to the `inputs` block in `flake.nix`.
2.  **Use Input**: The inputs are automatically passed to all modules via `specialArgs`. You can access them in your module arguments:
    ```nix
    { config, pkgs, inputs, ... }:
    # Use inputs.your-dependency in the module
    ```
3.  **Automatic Hashing**: When you run `update-nix`, Nix will automatically download the dependency and record its hash in `flake.lock`. No manual intervention is needed.
