# Syncthing

Syncthing is used to synchronize files between SKYLAB and other devices (Laptops, Phones) in a decentralized and secure way.

## Configuration Reference (NixOS 25.11)

The complete list of available options for the `services.syncthing` module can be found in the [official NixOS Options Search](https://search.nixos.org/options?channel=25.11&query=services.syncthing).

## Full Configuration Template

You can use this template in `modules/services/syncthing.nix` to configure the service exhaustively:

```nix
{ config, pkgs, ... }: {
  services.syncthing = {
    enable = true;
    user = "zipang";
    group = "users";
    dataDir = "/home/zipang";
    configDir = "/home/zipang/.config/syncthing";
    databaseDir = "/home/zipang/.config/syncthing";
    guiAddress = "127.0.0.1:8384";
    overrideDevices = true;
    overrideFolders = true;
    
    settings = {
      devices = {
        "DEVICE-NAME" = { id = "DEVICE-ID"; };
      };
      folders = {
        "folder-label" = {
          path = "/path/to/folder";
          devices = [ "DEVICE-NAME" ];
        };
      };
      options = {
        urAccepted = -1; # Disable usage reporting
      };
    };
  };
}
```

## Connexion to the GUI

See [Remote Web GUI](https://docs.syncthing.net/users/firewall.html#remote-web-gui) for reference.

The Syncthing GUI is only accessible via an SSH tunnel.

1.  **Create an SSH Tunnel**:
    From your laptop, run:
    ```bash
    ssh -L 8385:localhost:8384 <SKYLAB_IP>
    ```
2.  **Access the Web GUI**:
    Open your browser and navigate to `http://localhost:8385`.
3.  **Identify SKYLAB**:
    Go to **Actions > Show ID**. This is the unique identifier you will need to add SKYLAB to your other devices.

## Pairing a Device (Example: Android Phone)

1.  Install the Syncthing app on your phone.
2.  In the phone app, click the **+** or **Add Device** button.
3.  Scan the QR code shown on SKYLAB's "Show ID" screen or type the ID manually.
4.  Give it a name (e.g., "SKYLAB") and save.
5.  On SKYLAB's Web GUI, a notification will appear: "Device X wants to connect". Click **Add Device**.

## Syncing a Folder

1.  On your device (e.g., Phone), create or select a folder to sync.
2.  In the folder settings, go to the **Sharing** tab and check **SKYLAB**.
3.  On SKYLAB's Web GUI, a notification will appear: "Device X wants to share folder Y".
4.  Click **Add**.
5.  Choose the path on SKYLAB where you want the files to be stored (e.g., `/home/zipang/Sync/PhonePhotos`).
6.  Files will start syncing immediately.
