# Syncthing

Syncthing is used to synchronize files between SKYLAB and other devices (Laptops, Phones) in a decentralized and secure way.

## Configuration

The service is configured in `modules/services/syncthing.nix`.

*   **User**: `zipang`
*   **GUI**: Accessible on port `8384` of the server's IP.
*   **Firewall**: Ports `22000` (TCP/UDP) and `21027` (UDP) are opened automatically.

## Initial Setup

Since we rely on SSH keys for security, the Syncthing GUI is only accessible via an SSH tunnel.

1.  **Create an SSH Tunnel**:
    From your laptop, run:
    ```bash
    ssh -L 8384:localhost:8384 zipang@<SKYLAB_IP>
    ```
2.  **Access the Web GUI**:
    Open your browser and navigate to `http://localhost:8384`.
3.  **Identify SKYLAB**:
    Go to **Actions > Show ID**. This is the unique identifier you will need to add SKYLAB to your other devices.

## Pairing a Device (Example: Android Phone)

1.  Install the Syncthing app on your phone.
2.  In the phone app, click the **+** or **Add Device** button.
3.  Scan the QR code shown on SKYLAB's "Show ID" screen or type the ID manually.
4.  Give it a name (e.g., "SKYLAB") and save.
5.  On SKYLAB's Web GUI, a notification will appear: "Device X wants to connect". Click **Add Device**.

## Syncing a Folder

1.  On your device (e.g., Phone), create or select a folder to sync.
2.  In the folder settings, go to the **Sharing** tab and check **SKYLAB**.
3.  On SKYLAB's Web GUI, a notification will appear: "Device X wants to share folder Y".
4.  Click **Add**.
5.  Choose the path on SKYLAB where you want the files to be stored (e.g., `/home/zipang/Sync/PhonePhotos`).
6.  Files will start syncing immediately.

## Declarative Configuration

Once you have paired your main devices, we can add their IDs to the Nix configuration to make the setup permanent and reproducible.

Example structure for `modules/services/syncthing.nix`:
```nix
services.syncthing.settings.devices."device-name" = { id = "XXXXX-XXXXX-..."; };
services.syncthing.settings.folders."folder-name" = {
  path = "/home/zipang/path";
  devices = [ "device-name" ];
};
```
